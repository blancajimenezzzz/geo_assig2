---
title: "Assignment 2 - part 1"
author: "Pablo"
---

# 0. Packages

```{r}
library(sf) # simple features' library
library(spData) # library of spatial datasets
library(tidyverse) # dplyr, ggplot, ...
library(here)  # for setting relative paths
```


# 1. Combination of the `world` with more data

Combination with:

- Population (point) data (do not use rasters!)
- Ports, airports, etc.

## 1.1. World dataset

Loading the world dataset:

```{r}
gmsf_world <- world
View(gmsf_world)
```

We keep only the variables that interest us for this task:

```{r}
gmsf_world_sel <- gmsf_world %>% select(iso_a2, name_long, continent, type, pop, geom)
View(gmsf_world_sel)
rm(gmsf_world)
```

*Note*: just using the world dataset to produce a map of total population by country is not enough, as there are countries with missing values.

```{r}
# Plotting it with ggplot:
ggplot(gmsf_world_sel) +
  geom_sf(aes(fill=pop))
```

## 1.2. Population data by location

Source of the population data: https://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-populated-places/

```{r}
path_population_shp <- here("geo_assig2/map_1/populated_places", "ne_10m_populated_places.shp")
gmsf_population <- st_read(path_population_shp)
View(gmsf_population)
colnames(gmsf_population)
```

Again, we only select those variables that may interest us:

```{r}
gmsf_population_sel <- gmsf_population %>% 
  select(FEATURECLA, NAME, NAMEASCII, SOV0NAME, ADM0NAME, ISO_A2, POP_MAX, POP_MIN, geometry)
View(gmsf_population_sel)
rm(gmsf_population)
```

### Grouping population by country

Now, we group the population data by country:

```{r}
gmsf_population_country <- gmsf_population_sel %>% 
  group_by(SOV0NAME) %>% 
  summarise(total_pop = sum(POP_MAX))
head(gmsf_population_country)
View(gmsf_population_country)
```

Note how the aggregate populations are far from being representative for many countries (because there are many locations missing)! For instance, China only has approx. 300 million people according to this dataset.

### Merging with the `world` data

Now, we merge the population data with the world data, by geometry:

```{r}
pop_world_join <- st_join(gmsf_population_sel, gmsf_world_sel, join = st_within)
head(pop_world_join)
```

Aggregate the population by country:

```{r}
pop_by_country <- pop_world_join %>%
  group_by(name_long) %>%
  summarize(total_population = sum(POP_MAX, na.rm = TRUE))
head(pop_by_country)
View(pop_by_country)
```

Join the aggregated data back to the world dataset:

```{r}
world_pop <- left_join(
  world,
  st_drop_geometry(pop_by_country),
  by = "name_long"
  )
```

Plot results:

```{r}
ggplot(world_pop) +
  geom_sf(aes(fill = total_population)) +
  scale_fill_viridis_c(option = "spectral", na.value = "grey50") +
  labs(fill = "Total Population") +
  theme_minimal()
```

## 1.3. Population data by country

Source of the population by country data: https://www.naturalearthdata.com/downloads/10m-cultural-vectors/10m-admin-0-countries/

```{r}
path_population_countries_shp <- here("geo_assig2/map_1/population_by_countries", "ne_10m_admin_0_countries.shp")
gmsf_population_by_countries <- st_read(path_population_countries_shp)
View(gmsf_population_by_countries)
colnames(gmsf_population_by_countries)
```

```{r}
rows_with_na <- gmsf_population_by_countries %>% filter(is.na(POP_EST))
head(rows_with_na)
```

There are no missing values for the population field.

## 1.4. Ports data

Source of the ports data: https://www.naturalearthdata.com/downloads/10m-cultural-vectors/ports/

```{r}
path_population_shp <- here("map_1/populated_places", "ne_10m_populated_places.shp")
gmsf_population <- st_read(path_population_shp)
View(gmsf_population)
```

## 1.5. Airports data

Source of the airports data: https://www.naturalearthdata.com/downloads/10m-cultural-vectors/airports/

# 2. Maps

## 2.1. Map of total population by country

```{r}
# Plotting it with ggplot:
ggplot(gmsf_population_by_countries) +
  geom_sf(aes(fill=POP_EST)) +
  scale_fill_distiller(palette = 'Spectral')
```

## 2.2. Histogram of country population distribution by continent



## 2.3. Histogram of (country-level) average distances between locations and ports or airports by continent